<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>COS - Menswear</title>
  <link rel="stylesheet" href="styles.css">
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
</head>
<body>
<!-- Header -->
  <header class="header">
    <nav class="navbar">
  <div class="nav-left">
    <a href="#">Women</a>
    <a href="#"><b>Men</b></a>
  </div>
  <div class="logo">
    <a href="home.html">COS</a>
  </div>
  <div class="nav-right">
    <i class='bx bx-search' id="search-icon" style="font-size: 22px;"></i>

 <!-- User dropdown -->
<div class="user-dropdown" style="position: relative;">
  <i class='bx bx-user' id="user-icon" style="font-size: 22px; cursor: pointer;"></i>
  <div id="user-menu" class="dropdown-hidden" style="
      position: absolute;
      right: 0;
      top: 28px;
      background-color: white;
      border: 1px solid #ddd;
      padding: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      z-index: 999;
    ">
    <a href="login.html" id="login-link" style="display: block; margin-bottom: 5px;">Đăng nhập</a>
    <a href="orders.html" id="orders-link" style="display: none; margin-bottom: 5px;">Đơn hàng</a>
    <a href="#" id="logout-link" style="display: none;">Đăng xuất</a>
  </div>
</div>

    <i class='bx bx-heart' style="font-size: 22px;"></i>
    <a href="cart.html" class="cart-icon" style="position: relative; text-decoration: none;">
      <i class='bx bx-shopping-bag' style="font-size: 22px; color: black;"></i>
      <span class="cart-count" style="position: absolute; top: -6px; right: -10px; background-color: red; color: white; font-size: 12px; padding: 2px 6px; border-radius: 50%;">0</span>
    </a>
    <span class="lang">EN/VN</span>
  </div>
</nav>
  </header>

    <!-- Search Box -->
<div class="search-box hidden">
  <input type="text" id="search-input" placeholder="Tìm kiếm sản phẩm..." />
</div>

    <!-- Danh mục -->
    <nav class="menu category-menu">
      <a href="#" data-category="all">ALL MENSWEAR</a>
      <a href="#" data-category="new">NEW ARRIVALS</a>
      <a href="#" data-category="knitwear">KNITWEAR</a>
      <a href="#" data-category="shirts">SHIRTS</a>
      <a href="#" data-category="trousers">TROUSERS</a>
    </nav>


  <!-- Breadcrumb -->
  <div class="breadcrumb">
    <a href="home.html">HOME</a> &gt; <a href="#">MEN</a> &gt; <span>VIEW ALL</span>
    <a href="cart.html" style="margin-left:auto; text-decoration:none; color:#000; font-weight:bold;">&lt; BACK TO CART</a>
  </div>

  <!-- Product Grid -->
  <main class="product-grid">
    <p id="no-results" style="text-align: center; margin-top: 20px; display: none;">Không tìm thấy sản phẩm nào phù hợp.</p>


    <!-- Mỗi product-card có data-category -->
    <div class="product-card" data-id="p1" data-category="new" data-name="Áo khoác da có nhiều túi" data-price="7290000" data-image="images/product01.jpg">
      <div class="image-container">
        <img src="images/product01.jpg" alt="Áo khoác da">
        <button class="add-to-cart-btn">Thêm vào giỏ</button>
      </div>
      <h3>Áo khoác da có nhiều túi</h3>
      <p>7.290.000 VND</p>
    </div>

    <div class="product-card" data-id="p2" data-category="knitwear" data-name="Áo Polo vải dệt kim mềm" data-price="5290000" data-image="images/product02.jpg">
      <div class="image-container">
        <img src="images/product02.jpg" alt="Áo len cashmere">
        <button class="add-to-cart-btn">Thêm vào giỏ</button>
      </div>
      <h3>Áo Polo vải dệt kim mềm</h3>
      <p>5.290.000 VND</p>
    </div>

    <div class="product-card" data-id="p3" data-category="shirts" data-name="Áo Sơ Mi" data-price="3490000" data-image="images/product03.jpg">
      <div class="image-container">
        <img src="images/product03.jpg" alt="Áo Sơ Mi">
        <button class="add-to-cart-btn">Thêm vào giỏ</button>
      </div>
      <h3>Áo Sơ Mi</h3>
      <p>3.490.000 VND</p>
    </div>

    <div class="product-card" data-id="p4" data-category="shirts" data-name="Áo Sơ Mi" data-price="6990000" data-image="images/product04.jpg">
      <div class="image-container">
        <img src="images/product04.jpg" alt="Áo sơ mi">
        <button class="add-to-cart-btn">Thêm vào giỏ</button>
      </div>
      <h3>Áo Sơ Mi</h3>
      <p>6.990.000 VND</p>
    </div>

    <div class="product-card" data-id="p5" data-category="knitwear" data-name="Áo Len" data-price="2990000" data-image="images/product05.jpg">
      <div class="image-container">
        <img src="images/product05.jpg" alt="Áo len">
        <button class="add-to-cart-btn">Thêm vào giỏ</button>
      </div>
      <h3>Áo Len</h3>
      <p>2.990.000 VND</p>
    </div>

    <div class="product-card" data-id="p6" data-category="trousers" data-name="Quần" data-price="4390000" data-image="images/pant01.jpg">
      <div class="image-container">
        <img src="images/pant01.jpg" alt="Áo hoodie">
        <button class="add-to-cart-btn">Thêm vào giỏ</button>
      </div>
      <h3>Quần Tây </h3>
      <p>4.390.000 VND</p>
    </div>

    <div class="product-card" data-id="p7" data-category="trousers" data-name="Quần" data-price="3590000" data-image="images/pant02.jpg">
      <div class="image-container">
        <img src="images/pant02.jpg" alt="Blazer">
        <button class="add-to-cart-btn">Thêm vào giỏ</button>
      </div>
      <h3>Quần Tây </h3>
      <p>3.590.000 VND</p>
    </div>

    <div class="product-card" data-id="p8" data-category="new" data-name="Áo Blazer Basic" data-price="1190000" data-image="images/product08.jpg">
      <div class="image-container">
        <img src="images/product08.jpg" alt="Áo basic">
        <button class="add-to-cart-btn">Thêm vào giỏ</button>
      </div>
      <h3>Áo Blazer Basic</h3>
      <p>1.190.000 VND</p>
    </div>

  </main>

  <div id="footer-placeholder"></div>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const cartCount = document.querySelector('.cart-count');
    let cart = JSON.parse(localStorage.getItem('cart')) || [];
    const loginPopup = document.getElementById("login-popup");
    const loginBtn = document.querySelector(".popup-btn");

    updateCartCount();

    // --- Dropdown và login/logout ---
    const userIcon = document.getElementById("user-icon");
    const userMenu = document.getElementById("user-menu");
    const loginLink = document.getElementById("login-link");
    const logoutLink = document.getElementById("logout-link");
    const ordersLink = document.getElementById("orders-link");
    const userLoggedIn = localStorage.getItem("loggedInUser");

    if (userLoggedIn) {
      loginLink && (loginLink.style.display = "none");
      logoutLink && (logoutLink.style.display = "block");
      ordersLink && (ordersLink.style.display = "block");
    } else {
      loginLink && (loginLink.style.display = "block");
      logoutLink && (logoutLink.style.display = "none");
      ordersLink && (ordersLink.style.display = "none");
    }

    if (userIcon && userMenu) {
      userIcon.addEventListener("click", function (e) {
        e.stopPropagation();
        userMenu.classList.toggle("dropdown-hidden");
      });

      window.addEventListener("click", function (e) {
        if (!e.target.closest('.user-dropdown')) {
          userMenu.classList.add("dropdown-hidden");
        }
      });
    }

    logoutLink && logoutLink.addEventListener("click", function () {
      localStorage.removeItem("loggedInUser");
      window.location.reload();
    });

    // --- Nút đăng nhập trong popup ---
    if (loginBtn) {
      loginBtn.addEventListener("click", function () {
        window.location.href = "login.html";
      });
    }

    // --- Thêm sản phẩm vào giỏ hàng ---
    document.querySelectorAll('.add-to-cart-btn').forEach(btn => {
      btn.addEventListener('click', function (event) {
        event.stopPropagation();

        const isLoggedIn = localStorage.getItem("isLoggedIn") === "true";
        if (!isLoggedIn) {
          if (loginPopup) loginPopup.classList.remove("hidden");
          return;
        }

        const card = btn.closest('.product-card');
        const name = card.querySelector('h3').textContent;
        const rawPrice = card.querySelector('p').textContent;
        const price = parseInt(rawPrice.replace(/[^\d]/g, ''));
        const image = card.querySelector('img').getAttribute('src');

        const index = cart.findIndex(item => item.name === name);
        if (index !== -1) {
          cart[index].quantity += 1;
        } else {
          cart.push({ name, price, image, quantity: 1 });
        }

        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartCount();
      });
    });

    function updateCartCount() {
      const totalItems = cart.reduce((sum, item) => sum + (item.quantity || 1), 0);
      if (cartCount) cartCount.textContent = totalItems;
    }

    // --- Lọc sản phẩm ---
    const menuLinks = document.querySelectorAll('.category-menu a');
    const productCards = document.querySelectorAll('.product-card');

    menuLinks.forEach(link => {
      link.addEventListener('click', function (e) {
        e.preventDefault();
        const selected = this.getAttribute('data-category');
        productCards.forEach(card => {
          const category = card.getAttribute('data-category');
          card.style.display = (selected === 'all' || selected === category) ? 'block' : 'none';
        });
      });
    });

    // --- Tìm kiếm sản phẩm ---
    const searchIcon = document.querySelector('.bx-search');
    const searchBox = document.querySelector('.search-box');
    const searchInput = document.getElementById('search-input');
    const noResultsMessage = document.getElementById('no-results');

    if (searchIcon && searchBox && searchInput) {
      searchIcon.addEventListener('click', () => {
        searchBox.classList.toggle('hidden');
        searchInput.focus();
      });

      searchInput.addEventListener('input', () => {
        const keyword = searchInput.value.trim().toLowerCase();
        let hasResult = false;

        productCards.forEach(card => {
          const name = card.getAttribute('data-name').toLowerCase();
          const isMatch = name.includes(keyword);
          card.style.display = isMatch ? 'block' : 'none';
          if (isMatch) hasResult = true;
        });

        noResultsMessage.style.display = (!hasResult && keyword !== '') ? 'block' : 'none';
      });
    }

    // --- Đóng popup đăng nhập ---
    document.addEventListener("click", function (event) {
      if (loginPopup && !loginPopup.classList.contains("hidden")) {
        const popupBox = loginPopup.querySelector(".popup-box");
        if (popupBox && !popupBox.contains(event.target)) {
          loginPopup.classList.add("hidden");
        }
      }
    });
  });

  document.querySelectorAll('.product-card').forEach(card => {
  card.addEventListener('click', () => {
    const name = card.getAttribute('data-name');
    const price = card.getAttribute('data-price');
    const image = card.getAttribute('data-image');

    const productDetail = { name, price, image };
    localStorage.setItem('productDetail', JSON.stringify(productDetail));
    window.location.href = "product-detail.html";
  });
});
//lấy id
  document.querySelectorAll(".product-card").forEach(card => {
  card.addEventListener("click", () => {
    const productId = card.dataset.id;
    localStorage.setItem("selectedProductId", productId);
    window.location.href = "product-detail.html";
  });
});
  fetch("footer.html")
    .then(res => res.text())
    .then(html => {
      document.getElementById("footer-placeholder").innerHTML = html;
    });
</script>
<script src="product-list.js"></script>
  <!-- Popup yêu cầu đăng nhập -->
  <div id="login-popup" class="popup-overlay hidden">
    <div class="popup-box">
      <p>Vui lòng đăng nhập.</p>
      <button class="popup-btn">Đăng nhập</button>
    </div>
  </div>

</body>
</html>
